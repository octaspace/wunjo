function initSliderBar(){const e=document.querySelectorAll(".nav-menu-btn");document.querySelectorAll(".nav-dropdown-content");e.forEach(function(e){e.addEventListener("click",function(){this.nextElementSibling.classList.toggle("hidden"),this.querySelector("svg").classList.toggle("rotate-180")})}),window.addEventListener("click",function(o){e.forEach(function(e){var t=e.nextElementSibling;e.contains(o.target)||t.contains(o.target)||(t.classList.add("hidden"),e.querySelector("svg").classList.remove("rotate-180"))})})}function closePopup(e){e.closest(".console-popup").classList.add("hidden")}function updateConsoleLog(){return new Promise((o,t)=>{processingTaskInBackend().then(()=>{fetch("/console-log",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{var e=e.reverse().map(e=>e.replace("\r","").trimEnd()).filter(e=>""!==e.trim()),t=e.join("\n");0<e.length&&e.slice(0,2).join("\n");o(t)}).catch(e=>{console.error("Log field deleted, message from setInterval:",e),t(e)})}).catch(e=>{console.error("Error processing task in backend:",e),t(e)})})}function frontendConsoleLogToBackendPrint(e){fetch("/console-log-print",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({print:e})}).then(e=>e.json()).then(e=>{200===e.status?(console.log("Successfully sent print message to backend."),updateConsoleLog()):console.error("Failed to send print message to backend.")}).catch(e=>{console.error("An error occurred:",e)})}async function processingTaskInBackend(){fetch("/synthesize-process").then(e=>e.json()).then(t=>{document.querySelector(".notification-title").title!==t.message&&(document.querySelectorAll(".notification").forEach(e=>{e.title=t.message}),toggleLogNotificationElements(t.status))}).catch(e=>{console.error(e)})}function toggleLogNotificationElements(e){let t="Wunjo",o;switch(e){case 100:t="Busy",o="text-dim-gray";break;case 200:break;case 300:t="Warning",o="text-warn-primary";break;case 404:t="Error",o="text-danger-primary"}e=document.querySelector(".notification-title");e.textContent=t,e.classList.remove("text-dim-gray","text-accent-primary","text-danger-primary","text-warn-primary"),o&&e.classList.add(o)}function handleDownloadLogConsole(){updateConsoleLog().then(e=>{var t,o;e&&(t="console_log_"+(new Date).toISOString()+".log",e=new Blob([e],{type:"text/plain"}),(o=document.createElement("a")).href=URL.createObjectURL(e),o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o))}).catch(e=>{console.error("Error downloading log:",e)})}function openNotificationMessageModal(e=null){var t=document.querySelector(".modal-log-notice-template").content.cloneNode(!0);const o=t.querySelector(".modal-root");function n(){updateConsoleLog().then(e=>{var t;e&&((t=o.querySelector(".modal-root-textarea-log")).placeholder=e,t.scrollHeight<=parseFloat(getComputedStyle(t).maxHeight)?t.style.height=t.scrollHeight+"px":t.style.height=parseFloat(getComputedStyle(t).maxHeight)+"px")}).catch(e=>{console.error("Error updating log textarea:",e)})}e&&(o.querySelector(".modal-root-log-description").textContent=e.title),o.querySelector(".download-log").addEventListener("click",()=>{handleDownloadLogConsole()}),o.querySelector(".close-modal-log").addEventListener("click",()=>{toggleLogNotificationElements(200)}),n();const r=setInterval(n,1e3);o.querySelector(".close-modal-log").addEventListener("click",()=>{clearInterval(r)}),document.body.appendChild(t)}function initNotification(){document.querySelectorAll(".notification").forEach(e=>{e.addEventListener("click",()=>{openNotificationMessageModal(e)})})}function closeModal(e){e.closest(".modal-root").remove()}function uploadChunkFile(n,r="blob"){const a=n.size;let c=0;!function t(){var e=n.slice(c,c+10485760),o=new FormData;o.append("file",e,r),fetch("/upload-tmp",{method:"POST",body:o}).then(e=>{e.ok?(c+=10485760)<a?t():console.log("File uploaded successfully"):console.error("Upload failed")}).catch(e=>{console.error("Error:",e)})}()}function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function generateImageFilename(){return generateUUID()+".jpg"}function generateVideoFilename(){return generateUUID()+".mp4"}function generateAudioFilename(){return generateUUID()+".wav"}async function getLimitResolution(e){try{var t=await fetch("/get-resolution/"+e,{method:"GET",headers:{"Content-Type":"application/json"}});return t.ok?(await t.json()).max_content_size:(console.error("Error fetching data:",t.statusText),null)}catch(e){return console.error("Error:",e),null}}function setLimitResolution(e,t,o){var n=t/o;let r=t,a=o;return e<Math.max(t,o)&&(1<n?(r=e,a=Math.ceil(r/n)):(a=e,r=Math.ceil(a*n))),{newWidth:r,newHeight:a}}async function getAccess(){try{var e,t=await fetch("/get-access",{method:"GET",headers:{"Content-Type":"application/json"}});return t.ok?{hasFullAccess:(e=await t.json()).full_access,useCpu:e.use_cpu}:(console.error("Error fetching data:",t.statusText),null)}catch(e){return console.error("Error:",e),null}}async function moduleTileAnimation(){document.querySelectorAll(".module-tile").forEach(e=>{e.classList.contains("access-gpu-grayscale")||setTimeout(()=>{e.classList.remove("grayscale-100"),e.classList.add("grayscale-0")},0)})}async function setAccess(){const t=await getAccess();t?document.querySelectorAll(".access-admin").forEach(e=>{!1===t.access&&e.remove()}):console.error("Failed to fetch access data.")}function indicateUpdateVersion(){var e=JSON.parse(serverVersionData).version,t=currentVersionDiv.getAttribute("vers");0<function(e,t){var o=e.split(".").map(Number),n=t.split(".").map(Number);for(let e=0;e<Math.max(o.length,n.length);e++){var r=o[e]||0,a=n[e]||0;if(r<a)return-1;if(a<r)return 1}return 0}(e,t)?currentVersionDiv.innerHTML='<div class="cursor-pointer rounded-md flex items-center justify-center transition-all font-normal disabled:cursor-not-allowed px-1.5 gap-1.5 py-1.5 h-max self-center !pr-3 text-accent-primary group duration-500"><svg class="group-hover:fill-accent" width="23px" height="23px" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" stroke-width="3" stroke="#000000" fill="none" style="stroke: rgb(200 237 210);"><path d="M30,52.16c.81-2.07,7.06-17,19.76-19.86a.09.09,0,0,0,0-.18c-2.14-.86-15.22-6.57-19.38-20.26a.09.09,0,0,0-.18,0c-.51,2.27-3.94,14.43-20,20a.1.1,0,0,0,0,.19c2.24.38,13.48,3.14,19.62,20.15A.1.1,0,0,0,30,52.16Z"></path><path d="M48.79,25.08c.29-.74,2.52-6.07,7.06-7.09a0,0,0,0,0,0-.07c-.76-.3-5.43-2.34-6.92-7.23a0,0,0,0,0-.07,0c-.18.82-1.4,5.16-7.14,7.13a0,0,0,0,0,0,.07c.8.14,4.81,1.12,7,7.2A0,0,0,0,0,48.79,25.08Z"></path></svg>Update</div>':currentVersionDiv.innerHTML=`v${t}ce`}updateConsoleLog(),consoleBackendLogSetInterval=setInterval(updateConsoleLog,1e3),indicateUpdateVersion();
