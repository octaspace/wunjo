class SendModuleDataGeneration{constructor(e){this.method=e,this.subMethod=e,this.moduleParameters={nameFile:generateUUID(),aspectRatio:1.77,sdModel:initDefaultSdModel(),positivePrompt:null,negativePrompt:null,seed:null,strength:.75,scale:7.5,controlStrength:.7,blurFactor:10,FPS:12},this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null}}clearSourceFile(){this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null}}}const callbacks={fetchSendModuleDataCallback:openModalGenerationSubmit,setClearCallback:function(){sendModuleData.clearSourceFile()},toggleModificationCallback:!0,setTextareaCallback:setTextareaGeneration,setMetaButtonCallback:setMetaButtonGeneration,setMotionButtonCallback:!1,setParametersButtonCallback:null,setModuleImgButtonsCallback:setModuleImgButtons,setModuleVideoButtonsCallback:!1,setModuleAudioButtonsCallback:!1,setDefaultSendModuleData:SendModuleDataGeneration};let sendModuleData=new SendModuleDataGeneration(moduleName);function initDefaultSdModel(){for(const e of sdModels)if(e.hasOwnProperty("model"))return e.model;return null}function setAspectRatio(r=null){var e=document.createElement("div");e.classList.add("w-full","flex","flex-col","gap-3","mb-2","rounded-md","col-start-1","col-span-1","row-start-5","gap-2.5","p-2.5","bg-opacity-30","rounded-md","bg-dark-tags","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2","row-span-3"),(aspectRatioTitleDiv=document.createElement("div")).classList.add("flex","gap-3","items-center","justify-between"),(aspectRatioTitleP=document.createElement("p")).classList.add("font-extra-thick"),aspectRatioTitleP.textContent="Aspect ratio",aspectRatioTitleDiv.appendChild(aspectRatioTitleP);const s=document.createElement("div");function d(e,t,a=0){var[e,o]=e.split(":").map(Number);let l,n;o<=e?(l=t,n=t/e*o):(n=t,l=t/o*e);t=Math.pow(10,a);return l=Math.round(l*t)/t,n=Math.round(n*t)/t,{width:l,height:n}}s.classList.add("flex","gap-2","flex-wrap");const t=["16:9","9:16","1:1","5:2","4:5","4:3"];let c=null,u=null;return getLimitResolution(moduleName).then(i=>{t.forEach((e,t)=>{const a=d(e,i,0);var o=d(e,20,2);const l=document.createElement("button"),n=(l.textContent=e,l.type="button",l.classList.add("aspect-ratio-btn","rounded-md","flex","items-center","justify-center","transition-colors","font-normal","disabled:cursor-not-allowed","px-4","gap-2","py-2.5","flex-1","!bg-dark-elements-upper","!text-light-primary","hover:bg-dark-elements-hover","text-light-primary","bg-dark-pop-up"),document.createElement("span"));n.classList.add("max-w-5","max-h-5","border-[1.5px]","rounded-sm","shrink-0","transition-[border-color]","border-light-secondary"),n.style.width=o.width+"px",n.style.height=o.height+"px",0===t&&(sendModuleData.moduleParameters.aspectRatio=a.width/a.height,c=l,u=n,l.classList.remove("!bg-dark-elements-upper","!text-light-primary"),l.classList.add("!bg-accent-primary","!text-dark-background"),n.classList.remove("border-light-secondary"),n.classList.add("border-dark-background")),l.onclick=function(){sendModuleData.moduleParameters.aspectRatio=a.width/a.height,c&&(c.classList.add("!bg-dark-elements-upper","!text-light-primary"),c.classList.remove("!bg-accent-primary","!text-dark-background")),u&&(u.classList.add("border-light-secondary"),u.classList.remove("border-dark-background")),l.classList.remove("!bg-dark-elements-upper","!text-light-primary"),l.classList.add("!bg-accent-primary","!text-dark-background"),n.classList.remove("border-light-secondary"),n.classList.add("border-dark-background"),c=l,u=n,r&&"function"==typeof r&&r()},l.appendChild(n),s.appendChild(l)})}).catch(e=>{}),e.appendChild(aspectRatioTitleDiv),e.appendChild(s),e}async function openModalGenerationSubmit(){var e,t=document.querySelector(".modal-visual-generate-template").content.cloneNode(!0),a=t.querySelector(".modal-root"),o=(a.querySelector(".modal-canvas"),a.querySelector(".modal-parameters")),l=a.querySelector(".modal-redraw-btn"),a=a.querySelector(".modal-generate-btn");return o.appendChild(function(){var e=document.createElement("div"),t=(e.classList.add("group","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2","gap-2.5","text-m-mobile","md:tex-m","p-2.5","bg-opacity-30","rounded-md","bg-dark-tags","text-s","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2"),e.style.maxHeight="calc(933px - var(--navbar-height) - 60px)",document.createElement("div")),a=(t.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));a.classList.add("font-extra-thick",'underline','text-accent-primary'),a.innerHTML = 'Style<div class="bg-dark-pop-up bg-opacity-50 backdrop-blur-2xl absolute bottom-full -translate-y-1 left-1/2 -translate-x-1/2 lg:text-s text-s-mobile px-1.5 py-1 rounded-md after:absolute after:top-full after:left-1/2 after:-translate-x-1/2 after:border-t-[5px] after:border-x-[3px] after:border-x-transparent after:border-t-dark-elements hidden hidden-on-touchscreen group-hover:block whitespace-nowrap z-[9999]">Add a new custom Stable Diffusion 1.5 model to the configuration file located at <code>./wunjo/all_models/custom_diffusion.json</code>.</div>';const i=document.createElement("div");i.classList.add("grid-cols-2","gap-5","grid","overflow-auto"),i.style.maxHeight="6.9rem";let r=0;return sdModels.forEach(e=>{if(e.hasOwnProperty("model")){var t=document.createElement("div");t.classList.add("group","flex","flex-col","justify-center","items-center","text-center");const n=document.createElement("button");n.classList.add("model-picker","w-[5.625rem]","h-[5.625rem]","rounded-md","opacity-60","group-hover:opacity-100","transition-all"),n.type="button";var a=document.createElement("p");a.classList.add("w-[5.625rem]"),a.style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;",e.hasOwnProperty("name")?a.textContent=e.name:a.textContent=(o=e.model)?(l=o.lastIndexOf("."),o.substring(0,l).replace(/_/g," ").toLowerCase().replace(/^\w/,e=>e.toUpperCase())):"Unknown",sendModuleData.moduleParameters.sdModel?sendModuleData.moduleParameters.sdModel===e.model&&(n.classList.remove("opacity-60"),n.style.border="2px solid white"):0===r&&(n.classList.remove("opacity-60"),n.style.border="2px solid white",sendModuleData.moduleParameters.sdModel=e.model),e.hasOwnProperty("img")?n.style.backgroundImage=`url(${e.img})`:n.style.backgroundColor="#0d0d0d",n.style.backgroundSize="cover",n.style.backgroundPosition="center",n.onclick=function(){i.querySelectorAll(".model-picker").forEach(e=>{e.classList.add("opacity-60"),e.style.border=""}),this.classList.remove("opacity-60"),this.style.border="2px solid white";var e=n.getAttribute("model");sendModuleData.moduleParameters.sdModel=e},e.hasOwnProperty("url")&&(n.title=e.url),n.setAttribute("model",e.model),t.appendChild(n),t.appendChild(a),i.appendChild(t),r++}var o,l}),t.appendChild(a),e.appendChild(t),e.appendChild(i),e}()),o.appendChild(function(){var e=document.createElement("div"),t=(e.classList.add("flex","gap-4","flex-col","gap-2.5","text-m-mobile","md:tex-m","p-2.5","bg-opacity-30","rounded-md","bg-dark-tags","text-s","flex","flex-col","gap-5","overflow-auto","transition-[height_max-height]","pr-2"),sendModuleData.moduleParameters.FPS),a=document.createElement("div"),o=(a.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));o.classList.add("font-extra-thick"),o.textContent="Frames per second";const l=document.createElement("input");l.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-8","box-content","text-center","outline-none"),l.min="1",l.max="24",l.step="1",l.value=t,l.type="number";var n=document.createElement("div"),i=(n.classList.add("flex","gap-4","items-center","text-m-mobile","lg:text-m"),document.createElement("span"));i.classList.add("opacity-60"),i.textContent=l.min,i.title="Reduce control strength to less depend to frames.";const r=document.createElement("input");r.classList.add("relative","slider","flex-1","appearance-none","h-1","bg-light-border","rounded-md","outline-none","after:absolute","after:left-0","after:top-0","after:h-1","after:rounded-md","after:bg-accent-primary","after:w-[var(--fill-size)]","after:z-0"),r.min="1",r.max="24",r.step="1",r.value=t;let s=Math.ceil((r.value-r.min)/(r.max-r.min)*100);return r.style.setProperty("--fill-size",s+"%"),r.type="range",(t=document.createElement("span")).classList.add("opacity-60"),t.textContent=l.max,t.title="Increase control strength to up depend to frames.",l.addEventListener("change",function(){sendModuleData.moduleParameters.FPS=this.value,r.value=this.value,s=Math.ceil((this.value-this.min)/(this.max-this.min)*100),r.style.setProperty("--fill-size",s+"%")}),r.addEventListener("input",function(){sendModuleData.moduleParameters.FPS=this.value,l.value=this.value,s=Math.ceil((this.value-this.min)/(this.max-this.min)*100),r.style.setProperty("--fill-size",s+"%")}),a.appendChild(o),a.appendChild(l),n.appendChild(i),n.appendChild(r),n.appendChild(t),e.appendChild(a),e.appendChild(n),e}()),sendModuleData.sourceFile.urlFile||((e=document.createElement("div")).classList.add("text-m-mobile","md:tex-m","text-s"),e.appendChild(setAspectRatio()),o.appendChild(e)),l.onclick=function(){createModalVisualRedraw()},a.onclick=function(){fetchSendModuleDataVideoGeneration(),closeModal(this)},document.body.appendChild(t),{statusBool:!0,validMessage:""}}function setTextareaGeneration(e=0){var t=document.createElement("div");t.classList.add("w-full","relative","flex","items-center","gap-2","bg-dark-elements","rounded-[.625rem]","pl-4","pr-2");const a=document.createElement("textarea");a.classList.add("opacity-60","hover:opacity-100","bg-transparent","my-1","appearance-none","font-mono","outline-none","w-full","resize-none","placeholder:text-light-secondary","flex-1","h-5","disabled:cursor-not-allowed","lg:text-regular","text-regular-mobile"),a.rows=1,a.placeholder="Describe the change you want to make",a.maxlength=3e3;var o=document.createElement("div"),l=(o.classList.add("max-md:hidden","flex","gap-3","items-center"),document.createElement("button"));return l.classList.add("opacity-60","hover:opacity-100","flex","gap-2","items-center","relative","opacity-60","hover:opacity-100","transition-opacity","py-1.5","px-0","confetti-button"),l.title="Inspire me",l.type="button",l.innerHTML='<svg fill="white" width="30px" height="30px" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"> <path d="M47.895 88.097c.001-4.416 3.064-9.837 6.854-12.117l66.257-39.858c3.785-2.277 9.915-2.277 13.707.008l66.28 39.934c3.786 2.28 6.853 7.703 6.852 12.138l-.028 79.603c-.001 4.423-3.069 9.865-6.848 12.154l-66.4 40.205c-3.781 2.29-9.903 2.289-13.69-.01l-66.167-40.185c-3.78-2.295-6.842-7.733-6.84-12.151l.023-79.72zm13.936-6.474l65.834 36.759 62.766-36.278-62.872-36.918L61.83 81.623zM57.585 93.52c0 1.628-1.065 71.86-1.065 71.86-.034 2.206 1.467 4.917 3.367 6.064l61.612 37.182.567-77.413s-64.48-39.322-64.48-37.693zm76.107 114.938l60.912-38.66c2.332-1.48 4.223-4.915 4.223-7.679V93.125l-65.135 37.513v77.82z"></path><path d="M77.76 132.287c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm32 21c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm-32 16c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm32 21c-4.782 2.762-11.122.735-14.16-4.526-3.037-5.261-1.622-11.765 3.16-14.526 4.783-2.762 11.123-.735 14.16 4.526 3.038 5.261 1.623 11.765-3.16 14.526zm78.238-78.052c-4.783-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.623 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zm-16.238 29c-4.782-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.622 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zm-17 28c-4.782-2.762-11.122-.735-14.16 4.526-3.037 5.261-1.622 11.765 3.16 14.526 4.783 2.762 11.123.735 14.16-4.526 3.038-5.261 1.623-11.765-3.16-14.526zM128.5 69c-6.351 0-11.5 4.925-11.5 11s5.149 11 11.5 11S140 86.075 140 80s-5.149-11-11.5-11z"></path></g></svg>',a.addEventListener("click",function(){createModalVisualTextarea(a)}),l.addEventListener("click",function(){a.value=getRandomPrompt(),sendModuleData.moduleParameters.positivePrompt=a.value}),o.appendChild(l),t.appendChild(a),t.appendChild(o),t}function getRandomPrompt(){var e=["A stuffed animal donkey grazing in a valley","Cinematic, sunny day, waves crashing on the shore of a beach","A cow grazing in a valley during the day, a UFO approaches in the distance","A flower blooming in slow motion","3D render, a raccoon holding a mini ice cream cone","POV of a car driving in outer space traveling through time, time travel tunnel","2 cats in love eating a candlelit dinner of fresh fish","Cinematic, a dog in a car window","Moody, filmic, 35mm, a doctor walking into the hospital","POV of a car driving in outer space traveling through time, time travel tunnel","3D render, goldfish swimming in a glass container","Nature documentary, jellyfish swimming in the ocean","Cinematic, a Tibetan monk sitting in a temple on a mountain, facing camera.","Nature documentary, natural lighting, flamingo walking in a beautiful beach, head turning","Low angle dolly in shot, a wild west town with saloons and dusty streets","A secret garden with a rainbow waterfall","Cinematic, a cowboy riding a horse on mirror-like lake, moving clouds","Cinematic, long tracking shot of the cliffs of Dover","1950s film style, a seagull on a boat","Cinematic, sunny day, waves crashing on the shore of a beach","A woman smiling while watching fireworks","Beautiful sunset at the beach, silhouette of a couple walking by the seashore against sunset, beautiful scenery","Low angle dolly in shot, a wild west town with saloons and dusty streets","Anime, a boy and a girl sitting on the grass under the starry sky","Nature documentary, close up of a lizard in a desert","1940s newsreel footage, a soldier stands watch on a rocky hill, facing camera","Anime, a woman walking home with groceries, wide angle","Watercolor style of a baby elephant drinking water from a lake in the desert","Futuristic film of a man walking on a street in Paris, cinematic, symmetric composition","Claymation, stop motion, a rat sitting on a huge block of cheese"];return e[Math.floor(Math.random()*e.length)]}function createModalVisualTextarea(e){"ontouchstart"in window||navigator.msMaxTouchPoints;var t=document.querySelector(".modal-visual-textarea-template").content.cloneNode(!0);const a=t.querySelector(".modal-root"),o=(a.querySelector("p").innerHTML=`<b class="text-accent-primary">Prompt:</b> It's like describe a genie your wishes so they can conjure up just what you need!`,a.querySelector(".modal-positive-prompt")),l=(o.placeholder="(Optional) Describe your prompt for generation, or leave it blank for a random request. You can use (word) to emphasize specific requests and word:non-integers number from 0 to 1 for request intensity. For example, dog:0.8, cat:0.2 in one prompt. The maximum number of symbols is 3000.",o.maxlength=3e3,sendModuleData.moduleParameters.positivePrompt&&(o.value=sendModuleData.moduleParameters.positivePrompt),a.querySelector(".modal-negative-prompt")),n=a.querySelectorAll(".modal-seed"),i=a.querySelectorAll(".modal-strength");var r=a.querySelectorAll(".modal-strength-slider");const s=a.querySelectorAll(".modal-scale");var d=a.querySelectorAll(".modal-scale-slider");o.value=sendModuleData.moduleParameters.positivePrompt,l.value=sendModuleData.moduleParameters.negativePrompt,n.forEach(e=>{e.value=sendModuleData.moduleParameters.seed}),i.forEach(e=>{e.value=sendModuleData.moduleParameters.strength}),r.forEach(e=>{e.value=sendModuleData.moduleParameters.strength,strengthFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",strengthFillSize+"%")}),s.forEach(e=>{e.value=sendModuleData.moduleParameters.scale}),d.forEach(e=>{e.value=sendModuleData.moduleParameters.scale,scaleFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",scaleFillSize+"%")});const c=Math.floor(1000001*Math.random());function u(e,t,a){const o=a.value,l=Math.ceil((o-a.min)/(a.max-a.min)*100);e.forEach(e=>{e.value=o,e.style.setProperty("--fill-size",l+"%")}),t.forEach(e=>{e.value=o})}function m(t,a){t.forEach(e=>{e.addEventListener("change",function(){u(a,t,this)})}),a.forEach(e=>{e.addEventListener("input",function(){u(a,t,this)})})}n.forEach(e=>{e.value||(e.value=c)}),n.forEach(e=>{e.addEventListener("change",function(e){const t=e.target.value;n.forEach(e=>{e.value=t})})}),m(i,r),m(s,d),a.querySelector(".submit-text").onclick=function(){sendModuleData.moduleParameters.positivePrompt=o.value,sendModuleData.moduleParameters.negativePrompt=l.value,sendModuleData.moduleParameters.seed=n[0].value,sendModuleData.moduleParameters.strength=i[0].value,sendModuleData.moduleParameters.scale=s[0].value,e.value=o.value,closeModal(a)},document.body.appendChild(t)}async function createModalOutpaint(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".modal-outpaint-template").content.cloneNode(!0);const a=e.querySelector(".modal-root"),i=a.querySelector(".modal-canvas"),t=a.querySelector(".modal-load-element");var o=a.querySelector(".aspect-ratio"),l=a.querySelector(".download");const n=1280,r=a.querySelector(".modal-outpaint-prompt"),s=a.querySelector(".resolution"),d=a.querySelector(".modal-outpaint-btn"),c=a.querySelectorAll(".modal-blur-factor");var u,m,h=a.querySelectorAll(".modal-blur-factor-slider");const p=document.createElement("div");p.classList.add("w-auto","max-w-full","object-contain","h-full","justify-center","flex"),p.style="border:1px #ffffff7a solid;background: rgb(234 234 234 / 8%);",i.appendChild(p);let g,f;const v=new Image;function y(e=null,t=!1){d.disabled=t,document.querySelectorAll(".aspect-ratio-btn").forEach(e=>{e.disabled=t}),e&&(v.src=e)}function b(e,t){var a=e/t;return e>n||t>n?1<a?{width:n,height:Math.ceil(n/a)}:{width:Math.ceil(n*a),height:n}:{width:Math.ceil(e),height:Math.ceil(t)}}if(sendModuleData.sourceFile.urlFile&&["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())){{var w=sendModuleData.sourceFile.urlFile;if("string"==typeof w)w.startsWith("blob:"),v.src=w,v.setAttribute("default-src",w);else{if(!(w instanceof Blob||w instanceof File))return console.error("The src is not a valid string, Blob, or File"),null;w=URL.createObjectURL(w);v.src=w,v.setAttribute("default-src",w)}v.classList.add("w-auto","max-w-full","object-contain","h-full"),p.appendChild(v);let o=!1;v.onload=()=>{var e,t,a;o||(e=i.offsetWidth/i.offsetHeight,p.style.width=i.offsetWidth+"px",t=v.naturalWidth,a=v.naturalHeight,a=b((t=Math.max(t/e,a))*e,t),g=a.width,f=a.height,s.textContent=a.width+"x"+a.height,o=!0)}}l.onclick=function(){var e,t=a.querySelector("img");t&&(t=t.src,(e=document.createElement("a")).href=t,e.download=generateImageFilename(),document.body.appendChild(e),e.click(),document.body.removeChild(e))},u=c,m=h,u.forEach(e=>{e.addEventListener("change",function(){M(m,u,this)})}),m.forEach(e=>{e.addEventListener("input",function(){M(m,u,this)})}),o.appendChild(setAspectRatio(function(){v.src=v.getAttribute("default-src")||v.src;var e=i.offsetWidth/i.offsetHeight,t=sendModuleData.moduleParameters.aspectRatio,a=v.naturalWidth,o=v.naturalHeight,l=i.offsetWidth,n=i.offsetHeight;p.style.height="",f=(1<t?(p.style.width=t<e?l*(t/e)+"px":l+"px",p.offsetHeight>l/t&&(p.style.height=l/t+"px"),l=b((e=Math.max(a/t,o))*t,e),s.textContent=l.width+"x"+l.height,g=l.width,l):(p.style.width=n*t+"px",l=b(e=Math.max(o*t,a),e/t),s.textContent=l.width+"x"+l.height,g=l.width,l)).height})),d.onclick=function(){t.classList.remove("hidden");var e={blurFactor:c[0].value,positivePrompt:r.value,width:g,height:f};e.sourceImg=sendModuleData.sourceFile.urlFile,document.querySelectorAll(".aspect-ratio-btn").forEach(e=>{e.disabled=!0}),d.disabled=!0,fetchSendModuleDataOutpaint(e,y)},document.body.appendChild(e)}else console.error("This is not image.");function M(e,t,a){const o=a.value,l=Math.ceil((o-a.min)/(a.max-a.min)*100);e.forEach(e=>{e.value=o,e.style.setProperty("--fill-size",l+"%")}),t.forEach(e=>{e.value=o})}}async function createModalVisualRedraw(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".modal-redraw-template").content.cloneNode(!0);const l=e.querySelector(".modal-root"),r=l.querySelector(".modal-canvas"),t=l.querySelector(".modal-load-element");l.querySelector(".number-frames");var j=l.querySelector(".download"),H=l.querySelector(".upload");const a=l.querySelector(".modal-positive-prompt"),o=l.querySelector(".modal-negative-prompt");var B=l.querySelector(".inspire-button");const n=l.querySelector(".modal-img2img-btn"),i=l.querySelector(".modal-txt2img-btn"),s=l.querySelector(".modal-submit-btn"),d=l.querySelector(".brush-wheel");var R=l.querySelector(".clear-brush"),O=l.querySelector(".delete-button");const c=l.querySelectorAll(".modal-seed"),u=l.querySelectorAll(".modal-strength");var m=l.querySelectorAll(".modal-strength-slider");const h=l.querySelectorAll(".modal-scale");var p=l.querySelectorAll(".modal-scale-slider");const g=l.querySelectorAll(".modal-control-strength");var W=l.querySelectorAll(".modal-control-strength-slider");const f=l.querySelectorAll(".modal-blur-factor");var N=l.querySelectorAll(".modal-blur-factor-slider");const v=document.createElement("canvas"),U=(v.classList.add("w-auto","max-w-full","absolute","h-full","z-[1]","opacity-0","group-hover:opacity-60","transition-opacity","full-opacity-on-touchscreen"),sendModuleData.moduleParameters.seed||Math.floor(1000001*Math.random())),y=(c.forEach(e=>{e.value=U}),sendModuleData.moduleParameters.scale||7.5),b=(h.forEach(e=>{e.value=y}),p.forEach(e=>{e.value=y,elementFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",elementFillSize+"%")}),sendModuleData.moduleParameters.strength||.75),w=(u.forEach(e=>{e.value=b}),m.forEach(e=>{e.value=b,elementFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",elementFillSize+"%")}),sendModuleData.moduleParameters.controlStrength||.7),M=(g.forEach(e=>{e.value=w}),W.forEach(e=>{e.value=w,elementFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",elementFillSize+"%")}),sendModuleData.moduleParameters.blurFactor||10);f.forEach(e=>{e.value=M}),N.forEach(e=>{e.value=M,elementFillSize=Math.ceil((e.value-e.min)/(e.max-e.min)*100),e.style.setProperty("--fill-size",elementFillSize+"%")});var x=(null==sendModuleData.sourceFile.urlFile?getRandomPrompt():"")||sendModuleData.moduleParameters.positivePrompt||"",C=(a.value=x,sendModuleData.moduleParameters.negativePrompt||"");o.value=C;let S={seed:U,strength:b,controlStrength:w,blurFactor:M,scale:y,positivePrompt:x,negativePrompt:C,sourceCanvas:null};r.appendChild(v);const L=v.getContext("2d",{willReadFrequently:!0});let k=!1,E=!1,F=V(),D=(d.style.color=`rgb(${F})`,25);const P=document.createElement("div");function q(e=!0){n.disabled=e,i.disabled=e,s.disabled=e}function T(e=null,t=!1){if(q(t),e){t=l.querySelector("img");if(t){const a=L.getImageData(0,0,v.width,v.height);t.src=e,t.onload=function(){L.putImageData(a,0,0)}}else{const o=new Image;o.src=e,o.setAttribute("default-src",e),o.classList.add("w-auto","max-w-full","object-contain","h-full"),r.appendChild(o),o.onload=()=>{v.width=o.width,v.height=o.height}}}}if(P.classList.add("mouse-indicator","z-[2]"),r.appendChild(P),sendModuleData.sourceFile.urlFile&&["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())){const A=new Image;x=sendModuleData.sourceFile.urlFile;if("string"==typeof x)x.startsWith("blob:"),A.src=x,A.setAttribute("default-src",x);else{if(!(x instanceof Blob||x instanceof File))return console.error("The src is not a valid string, Blob, or File"),null;C=URL.createObjectURL(x);A.src=C,A.setAttribute("default-src",C)}A.classList.add("w-auto","max-w-full","object-contain","h-full"),r.appendChild(A),A.onload=()=>{v.width=A.width,v.height=A.height}}else{q(!0),t.classList.remove("hidden");x=sendModuleData.moduleParameters.aspectRatio;1<x?(S.width=1024,S.height=1024/x):(S.width=1024*x,S.height=1024),fetchSendModuleDataTxt2Img(S,T)}function V(){var e,t,a=[[255,77,0,100],[229,44,150,100],[200,237,210,100],[153,210,23,100],[0,143,255,100],[255,206,0,100]],o=a.length;return e=0,t=o,e=Math.ceil(e),t=Math.floor(t),a[(Math.floor(Math.random()*(t-e+1))+e)%o]}function z(e){var t,a,o;k&&(t=v.getBoundingClientRect(),o=v.width/t.width,a=v.height/t.height,o=(e.clientX-t.left)*o,e=(e.clientY-t.top)*a,L.lineWidth=D,L.lineCap="round",L.strokeStyle=`rgb(${F})`,L.lineTo(o,e),L.stroke(),L.beginPath(),L.moveTo(o,e))}function G(e){var t,a;E&&(t=v.getBoundingClientRect(),a=e.clientX-t.left,e=e.clientY-t.top,L.globalCompositeOperation="destination-out",L.beginPath(),L.arc(a,e,D/2,0,2*Math.PI),L.fill(),L.globalCompositeOperation="source-over")}function J(e,t,a){const o=a.value,l=Math.ceil((o-a.min)/(a.max-a.min)*100);e.forEach(e=>{e.value=o,e.style.setProperty("--fill-size",l+"%")}),t.forEach(e=>{e.value=o})}function I(t,a){t.forEach(e=>{e.addEventListener("change",function(){J(a,t,this)})}),a.forEach(e=>{e.addEventListener("input",function(){J(a,t,this)})})}v.addEventListener("mousedown",e=>{0===e.button?(k=!0,E=!1,z(e)):2===e.button&&(E=!0,k=!1,G(e))}),v.addEventListener("mouseup",()=>{k=!1,E=!1,L.beginPath()}),v.addEventListener("mousemove",e=>{var t,a,o,l,n,i;t=e,a=r.offsetWidth,o=r.offsetHeight,l=v.getBoundingClientRect(),n=v.width/l.width,i=v.height/l.height,n=(t.clientX-l.left)*n,t=(t.clientY-l.top)*i,l=D,i=(a-v.width)/2+n-l/2,a=(o-v.height)/2+t-l/2,P.style.display="block",P.style.width=D+"px",P.style.height=D+"px",P.style.left=i+"px",P.style.top=a+"px",P.style.border="1px solid white",z(e),G(e)}),v.addEventListener("mouseleave",()=>{P.style.display="none"}),v.addEventListener("contextmenu",e=>{e.preventDefault()}),v.addEventListener("touchstart",e=>{e.preventDefault();e=e.touches[0];k=!0,z(e)}),v.addEventListener("touchend",()=>{k=!1,E=!1,L.beginPath()}),v.addEventListener("touchmove",e=>{z(e.touches[0])}),window.addEventListener("resize",()=>{var e=l.querySelector("img");e&&(v.style.width=e.width,v.style.height=e.height)}),c.forEach(e=>{e.addEventListener("change",function(e){const t=e.target.value;c.forEach(e=>{e.value=t})})}),I(u,m),I(h,p),I(g,W),I(f,N),B.onclick=function(){a.value=getRandomPrompt()},H.onclick=async function(){var e=document.createElement("input");e.type="file",e.accept=".png, .jpg, .jpeg",e.click(),e.onchange=function(e){var t,e=e.target.files[0];e&&((t=new FileReader).onload=function(e){const t=l.querySelector("img");t&&(t.src=e.target.result,t.onload=()=>{v.width=t.width,v.height=t.height})},t.readAsDataURL(e))}},n.onclick=async function(){var e;0<a.value.length?(a.parentElement.classList.remove("border-danger-primary","border"),loaderModalInfo("Generation... Buttons are locked until finished. Tap on the screen to view details."),t.classList.remove("hidden"),(e=l.querySelector("img"))&&(S.sourceImg=e.src),S.positivePrompt=a.value,S.negativePrompt=o.value,S.seed=c[0].value,S.strength=u[0].value,S.scale=h[0].value,S.controlStrength=g[0].value,S.blurFactor=f[0].value,S.sourceCanvas=await saveCanvasAsJPEG(v,e.naturalWidth,e.naturalHeight),q(!0),await fetchSendModuleDataInpaint(S,T)):a.parentElement.classList.add("border-danger-primary","border")},O.onclick=function(){const e=l.querySelector("img");if(e){var t=e.getAttribute("default-src");if(t){const a=L.getImageData(0,0,v.width,v.height);e.src=t,e.onload=function(){L.putImageData(a,0,0),v.width===e.width&&v.height===e.height||(v.width=e.width,v.height=e.height)}}}},R.onclick=function(){var e=l.querySelector("img");e&&(v.width=e.width,v.height=e.height,L.clearRect(0,0,v.width,v.height))},d.addEventListener("contextmenu",function(e){e.preventDefault(),2===e.button&&(F=V(),d.style.color=`rgb(${F})`)}),d.addEventListener("mousedown",function(e){0===e.button&&(1.4<.1+(e=parseFloat(window.getComputedStyle(this).fontSize)/16)?(this.style.fontSize="0.5rem",D=5):(this.style.fontSize=.1+e+"rem",D+=5))}),j.onclick=function(){var e,t=l.querySelector("img");t&&(t=t.src,(e=document.createElement("a")).href=t,e.download=generateImageFilename(),document.body.appendChild(e),e.click(),document.body.removeChild(e))},i.onclick=function(){q(!0),S.positivePrompt=a.value,S.negativePrompt=o.value,S.seed=c[0].value,S.strength=u[0].value,S.scale=h[0].value;var e=sendModuleData.moduleParameters.aspectRatio;1<e?(S.width=1024,S.height=1024/e):(S.width=1024*e,S.height=1024),t.classList.remove("hidden"),fetchSendModuleDataTxt2Img(S,T)},s.onclick=async function(){var e=l.querySelector("img");sendModuleData.sourceFile.urlFile=e.src,sendModuleData.sourceFile.formatFile="jpg",sendModuleData.moduleParameters.positivePrompt=a.value,sendModuleData.moduleParameters.negativePrompt=o.value,sendModuleData.moduleParameters.seed=c[0].value,sendModuleData.moduleParameters.strength=u[0].value,sendModuleData.moduleParameters.scale=h[0].value,closeModal(this)},document.body.appendChild(e)}async function saveCanvasAsJPEG(e,t,a,o=.8){var l=generateImageFilename(),n=!e.getContext("2d").getImageData(0,0,e.width,e.height).data.some(e=>0!==e),i=document.createElement("canvas"),r=(i.width=t,i.height=a,i.getContext("2d"));n?(r.fillStyle="white",r.fillRect(0,0,t,a),console.log("Canvas is empty. Saving a black image.")):r.drawImage(e,0,0,t,a);let s=i.toDataURL("image/jpeg",o);return(s="string"==typeof s?await urlToBlob(s):s)&&(console.log("download file"),await uploadChunkFile(s,l)),l}function setModuleImgButtons(){var e=[],t=setbuttonOutpaint();return e.push(t),e}function setbuttonOutpaint(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),o=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/select_text.png",a.alt="Complete the image",a.width=256,a.height=256,document.createElement("span")),l=(o.classList.add("text-m-mobile","lg:text-m"),o.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",o.textContent="Ready to have some fun? Complete the image and add new elements.",document.createElement("div")),n=(l.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),document.createElement("button")),i=(n.classList.add("outpaint-button","stroke-light-primary","text-light-primary","relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),n.type="button",n.innerHTML='<svg class="transition-[fill,opacity] opacity-60 group-hover:opacity-100" width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g > <path d="M13.9922 17H16.9922M19.9922 17H16.9922M16.9922 17V14M16.9922 17V20" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 9.4V4.6C4 4.26863 4.26863 4 4.6 4H9.4C9.73137 4 10 4.26863 10 4.6V9.4C10 9.73137 9.73137 10 9.4 10H4.6C4.26863 10 4 9.73137 4 9.4Z" stroke-width="1.5"></path> <path d="M4 19.4V14.6C4 14.2686 4.26863 14 4.6 14H9.4C9.73137 14 10 14.2686 10 14.6V19.4C10 19.7314 9.73137 20 9.4 20H4.6C4.26863 20 4 19.7314 4 19.4Z" stroke-width="1.5"></path> <path d="M14 9.4V4.6C14 4.26863 14.2686 4 14.6 4H19.4C19.7314 4 20 4.26863 20 4.6V9.4C20 9.73137 19.7314 10 19.4 10H14.6C14.2686 10 14 9.73137 14 9.4Z" stroke-width="1.5"></path> </g></svg>',document.createElement("span"));return i.textContent="Outpaint",n.onclick=function(){document.querySelector(".footer-preview")&&createModalOutpaint()},n.appendChild(i),t.appendChild(a),t.appendChild(o),l.appendChild(n),e.appendChild(t),e.appendChild(l),e}function setMetaButtonGeneration(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",document.createElement("div")),a=(t.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));a.classList.add("font-extra-thick"),a.textContent="Filename";const o=document.createElement("input");o.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-32","box-content","text-center","outline-none"),o.type="text",o.value=sendModuleData.moduleParameters.nameFile,o.disabled=!1,o.addEventListener("input",function(e){var t=e.target.value;/^[a-zA-Z0-9-]*$/.test(t)||(e.target.value=t.slice(0,-1)),sendModuleData.moduleParameters.nameFile=o.value}),t.appendChild(a),t.appendChild(o),e.appendChild(t)}async function fetchSendModuleDataInpaint(o,l=null){(async()=>{let e=o.sourceImg;var t=o.sourceCanvas,a=generateImageFilename(),a=("string"==typeof e&&(e=await urlToBlob(e)),uploadChunkFile(e,a),o.sourceImg=null,{method:moduleInpaintName,filename:a,canvasFileName:t,sdModel:sendModuleData.moduleParameters.sdModel,diffusionParameters:o});console.log(JSON.stringify(a,null,4)),await fetch("/submit-cpu-task",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){const t=e.id;setTimeout(()=>{getEventWithInterval(t,l)},1e3)}else loaderModalWarn("Something wrong..."+e.message)}).catch(e=>{loaderModalError("Something wrong...During create task. Tap on the screen to view details.")})})()}async function fetchSendModuleDataOutpaint(n,i=null){(async()=>{let e=n.sourceImg;var t=generateImageFilename(),a=("string"==typeof e&&(e=await urlToBlob(e)),uploadChunkFile(e,t),n.sourceImg=null,n.blurFactor),o=n.width,l=n.height,t={method:moduleOutpaintName,filename:t,width:o,height:l,blurFactor:a,sdModel:sendModuleData.moduleParameters.sdModel,diffusionParameters:n};console.log(JSON.stringify(t,null,4)),await fetch("/submit-cpu-task",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){const t=e.id;setTimeout(()=>{getEventWithInterval(t,i)},1e3)}else loaderModalWarn("Something wrong..."+e.message)}).catch(e=>{loaderModalError("Something wrong...During create task. Tap on the screen to view details.")})})()}async function fetchSendModuleDataTxt2Img(e,a=null){var t,o;e.sourceImg=null,t=e.width,o=e.height,t={method:moduleText2ImgName,sdModel:sendModuleData.moduleParameters.sdModel,width:t,height:o,diffusionParameters:e},console.log(JSON.stringify(t,null,4)),await fetch("/submit-cpu-task",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){const t=e.id;setTimeout(()=>{getEventWithInterval(t,a)},1e3)}else loaderModalWarn("Something wrong..."+e.message)}).catch(e=>{loaderModalError("Something wrong...During create task. Tap on the screen to view details.")})}async function fetchSendModuleDataVideoGeneration(){""===sendModuleData.moduleParameters.nameFile.trim()&&(sendModuleData.moduleParameters.nameFile=generateUUID()),sendModuleData.moduleParameters.positivePrompt&&""!==sendModuleData.moduleParameters.positivePrompt.trim()||(sendModuleData.moduleParameters.positivePrompt=getRandomPrompt());var t=sendModuleData.sourceFile.formatFile&&["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase())?{tmpFileName:generateImageFilename(),validMessage:""}:sendModuleData.sourceFile.formatFile?{tmpFileName:!1,validMessage:"Is not valid format."}:{tmpFileName:!0,validMessage:"Image will be generate."},a=t.tmpFileName,t=t.validMessage;if(a&&sendModuleData.sourceFile.formatFile){sendModuleData.sourceFile.nameFile=a;let e=sendModuleData.sourceFile.urlFile;if(!(e="string"==typeof e?await urlToBlob(e):e))return{statusBool:!1,validMessage:t};console.log("download file"),await uploadChunkFile(e,a),sendModuleData.sourceFile.urlFile=null,console.log(JSON.stringify(sendModuleData,null,4)),await postModuleTaskEvent(sendModuleData),sendModuleData.moduleParameters.nameFile=generateUUID(),sendModuleData.sourceFile.urlFile=URL.createObjectURL(e)}else{if(!a||sendModuleData.sourceFile.formatFile)return{statusBool:!1,validMessage:t};console.log(JSON.stringify(sendModuleData,null,4)),await postModuleTaskEvent(sendModuleData),sendModuleData.moduleParameters.nameFile=generateUUID()}return{statusBool:!0,validMessage:t}}const getEventWithInterval=async(e,a=null)=>{const o=setInterval(async()=>{await fetch("/query-cpu-task/"+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(200===e.status){if(clearInterval(o),!e.response)return loaderModalWarn("Oops! Something went wrong. Please click submit again after some time. Tap on the screen to view details."),void(a&&"function"==typeof a&&a(null,!1));var t=e.response.filename;a&&"function"==typeof a&&a(t),loaderModalHidden()}else 300===e.status?(loaderModalWarn(e.response.message),a&&"function"==typeof a&&a(null,!1)):404===e.status&&(loaderModalWarn(e.response.message),a)&&"function"==typeof a&&a(null,!1)}).catch(e=>{clearInterval(o),loaderModalError("Oops! An unexpected error occurred. Tap on the screen to view details."),a&&"function"==typeof a&&a(null,!0)})},3e3)};function createFooterFile(s=null){validFile=["text","image"];var e=document.querySelector(".footer-block"),t=document.querySelector(".footer-file-template").content.cloneNode(!0);const o=t.querySelector(".footer-root"),d=o.querySelector(".footer-notification"),a=o.querySelector(".footer-submit"),c=o.querySelector(".footer-input-root"),l=o.querySelector(".footer-input");var n=l.querySelector("label"),i=document.createElement("div"),r=(i.classList.add("relative"),document.createElement("i")),u=(r.classList.add("fa-solid","fa-paperclip"),r.style.scale="1.3",document.createElement("span")),m=(u.classList.add("max-md:hidden"),u.style.textWrap="nowrap",document.createElement("input"));function h(){a.disabled=!1,a.classList.remove("bg-light-emphasis","hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements","fill-white","opacity-20"),a.classList.add("!text-light-tertiary","hover:bg-accent-hover","text-dark-background","bg-accent-primary","fill-black","transition-colors","transition-opacity")}if(m.classList.add("hidden"),m.type="file",m.id="file-input",validFile&&Array.isArray(validFile)){if(validFile.includes("text")&&s&&"function"==typeof s.setTextareaCallback&&(p=s.setTextareaCallback(),Array.isArray(p)?p.forEach(e=>{e instanceof HTMLElement&&l.appendChild(e)}):p instanceof HTMLElement&&l.appendChild(p),h()),["image"].some(e=>validFile.includes(e))){const k={image:"image/png,image/jpeg"};var p=validFile.map(e=>k[e]).filter(Boolean).join(",");u.textContent=validFile.filter(e=>!e.toLowerCase().includes("text")).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" or "),m.accept=p,validFile&&validFile.includes("text")&&((p=document.createElement("div")).classList.add("z-30","bg-dark-pop-up","bg-opacity-50","backdrop-blur-2xl","absolute","bottom-full","-translate-y-1","left-1/2","-translate-x-1/2","lg:text-s","text-s-mobile","px-1.5","py-1","rounded-md","after:absolute","after:top-full","after:left-1/2","after:-translate-x-1/2","after:border-t-[5px]","after:border-x-[3px]","after:border-x-transparent","after:border-t-dark-elements","hidden","hidden-on-touchscreen","group-hover:block","whitespace-nowrap"),p.textContent="Input "+u.textContent.toLowerCase(),u.classList.add("hidden"),i.appendChild(p)),i.appendChild(r),n.appendChild(i),n.appendChild(u),n.appendChild(m)}const S=o.querySelector(".footer-parameters");if(s){if(s.toggleModificationCallback&&([p=null]=[s.toggleModificationCallback],"function"==typeof p)&&((r=o.querySelector(".footer-toggle")).classList.remove("hidden"),p(r)),s.setMetaButtonCallback){{var[g=null]=[s.setMetaButtonCallback];i=o.querySelector(".footer-meta-button");i.classList.remove("hidden");const E=i.querySelector("button"),F=(E.disabled=!1,E.querySelector(".description-button")),D=F.querySelector("div");function f(e){var t=S.querySelector(".footer-parameters-close");(S.contains(e.target)||E.contains(e.target))&&!t.contains(e.target)||(F.appendChild(D),E.querySelector("span").classList.remove("opacity-100"),E.querySelector("span").classList.add("opacity-0"),S.classList.add("hidden"),document.removeEventListener("click",f),S.querySelector("div").innerHTML="")}E.onclick=function(){D.remove(),E.querySelector("span").classList.remove("opacity-0"),E.querySelector("span").classList.add("opacity-100"),S.classList.remove("hidden"),validCallback(g),setTimeout(()=>{document.addEventListener("click",f)},100)}}M(!0)}if(s.setMotionButtonCallback){{var[v=null]=[s.setMotionButtonCallback];u=o.querySelector(".footer-motion-button");u.classList.remove("hidden");const P=u.querySelector("button"),q=P.querySelector(".description-button"),T=q.querySelector("div");function y(e){var t=S.querySelector(".footer-parameters-close");(S.contains(e.target)||P.contains(e.target))&&!t.contains(e.target)||(q.appendChild(T),P.querySelector("span").classList.remove("opacity-100"),P.querySelector("span").classList.add("opacity-0"),S.classList.add("hidden"),document.removeEventListener("click",y),S.querySelector("div").innerHTML="")}P.onclick=function(){T.remove(),P.querySelector("span").classList.remove("opacity-0"),P.querySelector("span").classList.add("opacity-100"),S.classList.remove("hidden"),validCallback(v),setTimeout(()=>{document.addEventListener("click",y)},100)}}x(!0)}if(s.setParametersButtonCallback){var[b=null]=[s.setParametersButtonCallback];n=o.querySelector(".footer-parameters-button");n.classList.remove("hidden");const z=n.querySelector("button"),I=(z.disabled=!1,z.querySelector(".description-button")),A=I.querySelector("div");function w(e){var t=S.querySelector(".footer-parameters-close");(S.contains(e.target)||z.contains(e.target))&&!t.contains(e.target)||(I.appendChild(A),z.querySelector("span").classList.remove("opacity-100"),z.querySelector("span").classList.add("opacity-0"),S.classList.add("hidden"),document.removeEventListener("click",w),S.querySelector("div").innerHTML="")}z.onclick=function(){A.remove(),z.querySelector("span").classList.remove("opacity-0"),z.querySelector("span").classList.add("opacity-100"),S.classList.remove("hidden"),validCallback(b),setTimeout(()=>{document.addEventListener("click",w)},100)}}}validFile&&m.addEventListener("change",function(e){C(e.target.files)});const L=new URLSearchParams(window.location.search).get("attachment");function M(e=!0){var t=o.querySelector(".footer-meta-button").querySelector("button"),a=t.querySelector(".description-button").querySelector("div");!0===e?(t.classList.add("opacity-20"),t.classList.remove("hover:opacity-100"),t.classList.remove("opacity-60"),t.disabled=e,a.classList.add("opacity-0")):(t.classList.remove("opacity-20"),t.classList.add("hover:opacity-100"),t.classList.add("opacity-60"),t.disabled=e,a.classList.remove("opacity-0"))}function x(e=!0){var t=o.querySelector(".footer-motion-button").querySelector("button"),a=t.querySelector(".description-button").querySelector("div");!0===e?(t.classList.add("opacity-20"),t.classList.remove("hover:opacity-100"),t.classList.remove("opacity-60"),t.disabled=e,a.classList.add("opacity-0")):(t.classList.remove("opacity-20"),t.classList.add("hover:opacity-100"),t.classList.add("opacity-60"),t.disabled=e,a.classList.remove("opacity-0"))}function C(e){if(0<e.length){const i=e[0];e=new FileReader;const r=Math.min(maxFileSize,i.size);e.onload=function(e){s&&s.setDefaultSendModuleData&&(t=s.setDefaultSendModuleData,sendModuleData=new t(moduleName)),d.textContent="",d.classList.add("hidden");var t=i.slice(0,r),t=(sendModuleData.sourceFile.urlFile=t,sendModuleData.sourceFile.fileSizeBytes=i.size,document.createElement("div"));t.classList.add("flex","gap-3","items-center","overflow-hidden");const a=document.createElement("span"),o=(a.classList.add("text-m-mobile","lg:text-m","opacity-60","leading-8"),document.createElement("span").classList.add("text-m-mobile","lg:text-m","opacity-60","leading-8"),document.createElement("div"));if(o.classList.add("flex","gap-3","items-center","basis-full","flex-wrap"),i.type.startsWith("image")&&validFile.includes("image")){const n=document.createElement("img");n.alt="Preview",n.classList.add("footer-preview","w-8","h-8","rounded-[.625rem]","object-cover"),n.src=e.target.result,n.onload=function(){a.textContent=n.naturalWidth+"x"+n.naturalHeight,sendModuleData.sourceFile.naturalWidth=n.naturalWidth,sendModuleData.sourceFile.naturalHeight=n.naturalHeight},t.appendChild(n),sendModuleData.sourceFile.formatFile="jpg",s&&(s.setMetaButtonCallback&&M(!1),s.setMotionButtonCallback&&x(!0),"function"==typeof s.setModuleImgButtonsCallback)&&(e=s.setModuleImgButtonsCallback(),Array.isArray(e)?e.forEach(e=>{e instanceof HTMLElement&&o.appendChild(e)}):e instanceof HTMLElement&&o.appendChild(e)),h()}var e=document.createElement("div"),l=(e.classList.add("ml-auto","flex","gap-3.5","items-center","p-1","h-8"),document.createElement("button"));l.type="button",l.classList.add("opacity-60","hover:opacity-100","transition-opacity"),l.innerHTML='<svg width="21px" height="21px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H20M16 6L15.7294 5.18807C15.4671 4.40125 15.3359 4.00784 15.0927 3.71698C14.8779 3.46013 14.6021 3.26132 14.2905 3.13878C13.9376 3 13.523 3 12.6936 3H11.3064C10.477 3 10.0624 3 9.70951 3.13878C9.39792 3.26132 9.12208 3.46013 8.90729 3.71698C8.66405 4.00784 8.53292 4.40125 8.27064 5.18807L8 6M18 6V16.2C18 17.8802 18 18.7202 17.673 19.362C17.3854 19.9265 16.9265 20.3854 16.362 20.673C15.7202 21 14.8802 21 13.2 21H10.8C9.11984 21 8.27976 21 7.63803 20.673C7.07354 20.3854 6.6146 19.9265 6.32698 19.362C6 18.7202 6 17.8802 6 16.2V6M14 10V17M10 10V17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',l.onclick=function(){c.classList.add("hidden"),c.innerHTML="",d.textContent="",d.classList.add("hidden"),s&&s.setClearCallback&&"function"==typeof s.setClearCallback&&s.setClearCallback()},c.innerHTML="",validFile.includes("image")&&t.appendChild(a),c.appendChild(t),e.appendChild(l),c.appendChild(e),0<o.childElementCount&&c.appendChild(o),c.classList.remove("hidden")},e.readAsDataURL(i)}else console.log("No files uploaded")}L&&validFile?fetch(L).then(e=>e.blob()).then(e=>{var t=L.split(".").pop().toLowerCase();let a;"application/octet-stream"!==(a=!validFile.includes("image")||"jpg"!==t&&"jpeg"!==t&&"png"!==t&&"gif"!==t?"application/octet-stream":"image/jpeg")&&C([new File([e],"filename",{type:a})])}).catch(e=>{console.error("Error fetching attachment:",e)}):console.log("No attachment URL found in query parameters"),a.onclick=function(){this.querySelector("svg").style.animation="paperClickForward 1.5s forwards",s&&s.fetchSendModuleDataCallback&&s.fetchSendModuleDataCallback().then(({statusBool:e,validMessage:t})=>{1==e?(d.textContent=t,d.classList.add("hidden"),this.innerHTML+='<i class="fa-solid fa-check absolute text-dark-background" style="animation: paperFadeInOut 3s forwards;"></i>'):(d.textContent=t,d.classList.remove("hidden"),this.innerHTML+='<i class="fa-solid fa-ban absolute text-dark-background" style="animation: paperFadeInOut 3s forwards;"></i>')}).catch(e=>{console.error(e),d.textContent=e,d.classList.remove("hidden"),this.innerHTML+='<i class="fa-solid fa-ban absolute text-dark-background" style="animation: paperFadeInOut 3s forwards;"></i>'}),setTimeout(()=>{this.querySelector("svg").style.animation="paperClickDisappear 2s forwards";var e=this.querySelector("i");e&&e.remove()},2500),setTimeout(()=>{this.querySelector("svg").style.animation=""},5e3)},e.appendChild(t)}}createFooterFile(callbacks);