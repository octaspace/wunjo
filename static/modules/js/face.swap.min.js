class SendModuleDataFaceSwap{constructor(e){this.method=e,this.moduleParameters={nameFile:generateUUID(),cropField:[],avatarCropField:[],faceDiscriminationFactor:1.3,isGeminiFaces:!1,replaceAllFaces:!1},this.sourceFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null},this.avatarFile={nameFile:null,urlFile:null,formatFile:null,fileSizeBytes:null,naturalWidth:null,naturalHeight:null,offsetWidth:null,offsetHeight:null,startTime:null,endTime:null}}}const callbacks={fetchSendModuleDataCallback:fetchSendModuleDataFaceSwap,toggleModificationCallback:null,setMetaButtonCallback:setMetaButtonFaceSwap,setMotionButtonCallback:setMotionButtonFaceSwap,setParametersButtonCallback:setParametersButtonFaceSwap,setModuleImgButtonsCallback:setModuleImgButtons,setModuleVideoButtonsCallback:setModuleVideoButtons,setDefaultSendModuleData:SendModuleDataFaceSwap};let sendModuleData=new SendModuleDataFaceSwap(moduleName);async function fetchSendModuleDataFaceSwap(){var e=function(){let e=!1,t=!1;if(!Array.isArray(sendModuleData.moduleParameters.cropField))return console.log("Crop field is not array"),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Wow! Seems like you didn't pick a face in your content witch need to swap. Click on the «Find face» button and set box on person face, please!"};if(0===sendModuleData.moduleParameters.cropField.length)return console.log("Crop field of source file is empty"),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Wow! Seems like you didn't pick a face in your content witch need to swap. Click on the «Find face» button and set box on person face, please!"};if(!Array.isArray(sendModuleData.moduleParameters.avatarCropField))return console.log("Avatar crop field is not array"),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Param Pam Pam! It seems like your avatar's face is feeling a bit missed!  Give that «Set avatar» button a click and upload a face with some personality!"};if(0===sendModuleData.moduleParameters.avatarCropField.length)return console.log("Avatar crop field of source file is empty"),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Param Pam Pam! It seems like your avatar's face is feeling a bit missed!  Give that «Set avatar» button a click and upload a face with some personality!"};if(""===sendModuleData.moduleParameters.nameFile.trim()&&(sendModuleData.moduleParameters.nameFile=generateUUID()),"number"!=typeof sendModuleData.sourceFile.offsetWidth||isNaN(sendModuleData.sourceFile.offsetWidth))return console.log("Offset width is not a number or is empty"),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Uh-oh! The width looks wonky. Double-check it's a number and not empty. Maybe click on «Select object» or load another file."};if("number"!=typeof sendModuleData.sourceFile.offsetHeight||isNaN(sendModuleData.sourceFile.offsetHeight))return console.log("Offset height is not a number or is empty"),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Hmm... The height seems fishy. Verify it's a number and not empty. Check it's a number and not empty. Maybe click on «Select object» or load another file."};if("number"!=typeof sendModuleData.avatarFile.offsetWidth||isNaN(sendModuleData.avatarFile.offsetWidth))return console.log("Offset width is not a number or is empty"),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Uh-oh! The width looks wonky. Double-check it's a number and not empty. Maybe click on «Select object» or load another file."};if("number"!=typeof sendModuleData.avatarFile.offsetHeight||isNaN(sendModuleData.avatarFile.offsetHeight))return console.log("Offset height is not a number or is empty"),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Hmm... The height seems fishy. Verify it's a number and not empty. Check it's a number and not empty. Maybe click on «Select object» or load another file."};if(["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.sourceFile.formatFile.toLowerCase()))e=generateImageFilename();else{if(!["mp4","avi","mov","wmv","mkv"].includes(sendModuleData.sourceFile.formatFile.toLowerCase()))return console.log("The format file is neither an image nor a video format."),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Yikes! Looks like an alien format. Stick to images or videos for now."};e=generateVideoFilename()}if(["jpg","jpeg","png","gif","bmp"].includes(sendModuleData.avatarFile.formatFile.toLowerCase()))t=generateImageFilename();else{if(!["mp4","avi","mov","wmv","mkv"].includes(sendModuleData.avatarFile.formatFile.toLowerCase()))return console.log("The format file is neither an image nor a video format."),{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:"Yikes! Looks like an alien format. Stick to images or videos for now."};t=generateVideoFilename()}return{tmpFileNameSrc:e,tmpFileNameDst:t,validMessage:""}}(),t=e.tmpFileNameSrc,a=e.tmpFileNameDst,e=e.validMessage;if(!1===t||!1===a)return{statusBool:!1,validMessage:e};sendModuleData.sourceFile.nameFile=t,sendModuleData.avatarFile.nameFile=a;let n=sendModuleData.sourceFile.urlFile;if(!(n="string"==typeof n?await urlToBlob(n):n))return{statusBool:!1,validMessage:e};console.log("download file"),await uploadChunkFile(n,t);let l=sendModuleData.avatarFile.urlFile;return(l="string"==typeof l?await urlToBlob(l):l)?(console.log("download file"),await uploadChunkFile(l,a),sendModuleData.sourceFile.urlFile=null,sendModuleData.avatarFile.urlFile=null,console.log(JSON.stringify(sendModuleData,null,4)),await postModuleTaskEvent(sendModuleData),sendModuleData.sourceFile.urlFile=URL.createObjectURL(n),sendModuleData.avatarFile.urlFile=URL.createObjectURL(l),{statusBool:!0,validMessage:e}):{statusBool:!1,validMessage:e}}function setMetaButtonFaceSwap(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",document.createElement("div")),a=(t.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));a.classList.add("font-extra-thick"),a.textContent="Filename";const n=document.createElement("input");n.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-32","box-content","text-center","outline-none"),n.type="text",n.value=sendModuleData.moduleParameters.nameFile,n.disabled=!1;var l=document.createElement("div"),i=(l.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));i.classList.add("font-extra-thick"),i.textContent="Resized to";const o=document.createElement("input");o.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-32","box-content","text-center","outline-none"),o.type="text",o.value="1280x720",o.disabled=!0,getLimitResolution(moduleName).then(e=>{var t=sendModuleData.sourceFile.naturalWidth,a=sendModuleData.sourceFile.naturalHeight,e=setLimitResolution(e,t,a);o.value=e.newWidth+"x"+e.newHeight}).catch(e=>{}),n.addEventListener("input",function(e){var t=e.target.value;/^[a-zA-Z0-9-]*$/.test(t)||(e.target.value=t.slice(0,-1)),sendModuleData.moduleParameters.nameFile=n.value}),t.appendChild(a),t.appendChild(n),l.appendChild(i),l.appendChild(o),e.appendChild(t),e.appendChild(l)}function setMotionButtonFaceSwap(){var e=document.querySelector(".footer-parameters").querySelector("div");e.innerHTML="";const t=sendModuleData.moduleParameters.faceDiscriminationFactor,a="10",n="0.1";var l=document.createElement("div"),i=(l.classList.add("flex","gap-3","items-center","justify-between"),document.createElement("p"));i.classList.add("font-extra-thick"),i.textContent="Face discrimination factor";const o=document.createElement("input");o.classList.add("px-2","py-1.5","rounded-md","bg-dark-elements","w-8","box-content","text-center","outline-none"),o.min=n,o.max=a,o.step="0.2",o.value=t,o.type="number";var s=document.createElement("div"),r=(s.classList.add("flex","gap-4","items-center","text-m-mobile","lg:text-m"),document.createElement("span"));r.classList.add("opacity-60"),r.textContent=o.min,r.title="Set to minimize false face recognitions in low-resolution or poor-quality videos, where faces are small and prone to similarity.";const d=document.createElement("input");d.classList.add("relative","slider","flex-1","appearance-none","h-1","bg-light-border","rounded-md","outline-none","after:absolute","after:left-0","after:top-0","after:h-1","after:rounded-md","after:bg-accent-primary","after:w-[var(--fill-size)]","after:z-0"),d.min=n,d.max=a,d.step="0.2",d.value=t;let c=Math.ceil((d.value-d.min)/(d.max-d.min)*100);d.style.setProperty("--fill-size",c+"%"),d.type="range";var m=document.createElement("span"),u=(m.classList.add("opacity-60"),m.textContent=o.max,m.title="Adjust to maximize face differentiation in high-resolution videos, where facial details are clearer, ensuring accurate face recognition.",document.createElement("span")),p=(u.classList.add("w-full","h-px","bg-white","bg-opacity-20","shrink-0"),document.createElement("button"));p.classList.add("text-light-primary","opacity-60","hover:opacity-100","transition-opacity","-mt-2"),p.textContent="Reset",p.type="button",o.addEventListener("change",function(){sendModuleData.moduleParameters.faceDiscriminationFactor=this.value,d.value=this.value,c=Math.ceil((this.value-this.min)/(this.max-this.min)*100),d.style.setProperty("--fill-size",c+"%")}),d.addEventListener("input",function(){sendModuleData.moduleParameters.faceDiscriminationFactor=this.value,o.value=this.value,c=Math.ceil((this.value-this.min)/(this.max-this.min)*100),d.style.setProperty("--fill-size",c+"%")}),p.onclick=function(){sendModuleData.moduleParameters.faceDiscriminationFactor=t,o.value=t,d.value=t,c=Math.ceil((t-n)/9.9*100),d.style.setProperty("--fill-size",c+"%")},l.appendChild(i),l.appendChild(o),s.appendChild(r),s.appendChild(d),s.appendChild(m),e.appendChild(l),e.appendChild(s),e.appendChild(u),e.appendChild(p)}function setParametersButtonFaceSwap(){var e=document.querySelector(".footer-parameters").querySelector("div"),t=(e.innerHTML="",document.createElement("div")),a=(t.classList.add("flex","gap-1.5","items-center"),document.createElement("p"));a.classList.add("flex-1","basis-1/3"),a.textContent="Gemini faces detection";const n=document.createElement("button");n.classList.add("rounded-md","flex","items-center","justify-center","transition-colors","font-normal","disabled:cursor-not-allowed","px-2.5","gap-2","py-2.5","basis-1/3","flex-1","!bg-dark-elements","hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements"),sendModuleData.moduleParameters.isGeminiFaces&&(n.classList.add("!bg-accent-primary","!text-dark-background"),n.classList.remove("!bg-dark-elements")),n.innerHTML='<i class="fa-solid fa-thumbs-up"></i>',n.type="button";var l=document.createElement("div"),i=(l.classList.add("flex","gap-1.5","items-center"),document.createElement("p"));i.classList.add("flex-1","basis-1/3"),i.textContent="Replace all detected faces";const o=document.createElement("button");o.classList.add("rounded-md","flex","items-center","justify-center","transition-colors","font-normal","disabled:cursor-not-allowed","px-2.5","gap-2","py-2.5","basis-1/3","flex-1","!bg-dark-elements","hover:bg-dark-elements-hover","text-light-primary","bg-dark-elements"),sendModuleData.moduleParameters.replaceAllFaces&&(o.classList.add("!bg-accent-primary","!text-dark-background"),o.classList.remove("!bg-dark-elements")),o.innerHTML='<i class="fa-solid fa-thumbs-up"></i>',o.type="button";var s=document.createElement("span"),r=(s.classList.add("w-full","h-px","bg-white","bg-opacity-20","shrink-0"),document.createElement("button"));r.classList.add("text-light-primary","opacity-60","hover:opacity-100","transition-opacity","-mt-2"),r.textContent="Reset",r.type="button",n.onclick=function(){n.classList.contains("!bg-dark-elements")?(n.classList.add("!bg-accent-primary","!text-dark-background"),n.classList.remove("!bg-dark-elements"),sendModuleData.moduleParameters.isGeminiFaces=!0):(n.classList.remove("!bg-accent-primary","!text-dark-background"),n.classList.add("!bg-dark-elements"),sendModuleData.moduleParameters.isGeminiFaces=!1)},o.onclick=function(){o.classList.contains("!bg-dark-elements")?(o.classList.add("!bg-accent-primary","!text-dark-background"),o.classList.remove("!bg-dark-elements"),sendModuleData.moduleParameters.replaceAllFaces=!0):(o.classList.remove("!bg-accent-primary","!text-dark-background"),o.classList.add("!bg-dark-elements"),sendModuleData.moduleParameters.replaceAllFaces=!1)},r.onclick=function(){n.classList.remove("!bg-accent-primary","!text-dark-background"),n.classList.add("!bg-dark-elements"),o.classList.remove("!bg-accent-primary","!text-dark-background"),o.classList.add("!bg-dark-elements"),sendModuleData.moduleParameters.isGeminiFaces=!1,sendModuleData.moduleParameters.replaceAllFaces=!1},t.appendChild(a),t.appendChild(n),l.appendChild(i),l.appendChild(o),e.appendChild(t),e.appendChild(l),e.appendChild(s),e.appendChild(r)}function setModuleImgButtons(){var e=[],t=setButtonSelectSourceFaceSwap(),a=setButtonSelectDestinationFaceSwap(),n=setButtonSelectAnalysis();return e.push(t,a,n),e}function setModuleVideoButtons(){var e=[],t=setButtonSelectSourceFaceSwap(),a=setButtonSelectDestinationFaceSwap(),n=setButtonSelectAnalysis();return e.push(t,a,n),e}function setButtonSelectSourceFaceSwap(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),n=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/find_face.png",a.alt="Source face area select explain",a.width=256,a.height=256,document.createElement("span")),l=(n.classList.add("text-m-mobile","lg:text-m"),n.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",n.textContent="Pick face to swap. Select start and end for seamless changes. No cutting, just smooth transitions. Easy!",document.createElement("div")),i=(l.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),l.style.stroke="white",document.createElement("button")),o=(i.classList.add("stroke-danger-primary","text-danger-primary","relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),i.type="button",i.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="transition-[stroke,opacity] opacity-60 group-hover:opacity-100"><path d="M8 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V8M8 21H7.8C6.11984 21 5.27976 21 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3 18.7202 3 17.8802 3 16.2V16M21 8V7.8C21 6.11984 21 5.27976 20.673 4.63803C20.3854 4.07354 19.9265 3.6146 19.362 3.32698C18.7202 3 17.8802 3 16.2 3H16M21 16V16.2C21 17.8802 21 18.7202 20.673 19.362C20.3854 19.9265 19.9265 20.3854 19.362 20.673C18.7202 21 17.8802 21 16.2 21H16M7.5 8V9.5M16.5 8V9.5M11 12.6001C11.8 12.6001 12.5 11.9001 12.5 11.1001V8M15.2002 15.2C13.4002 17 10.5002 17 8.7002 15.2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',document.createElement("span"));return o.textContent="Find face",i.onclick=function(){var e=document.querySelector(".footer-preview");e&&("img"===e.tagName.toLowerCase()&&e.src?createModalCropperImage(sendModuleData.sourceFile.urlFile,this,null):"video"===e.tagName.toLowerCase()&&e.src&&createModalCropperVideo(sendModuleData.sourceFile.urlFile,this,null))},i.appendChild(o),t.appendChild(a),t.appendChild(n),l.appendChild(i),e.appendChild(t),e.appendChild(l),e}function setButtonSelectDestinationFaceSwap(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),n=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/set_avatar.png",a.alt="Set avatar face explain",a.width=256,a.height=256,document.createElement("span")),l=(n.classList.add("text-m-mobile","lg:text-m"),n.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",n.textContent="Upload photo, craft avatar, choose face to swap. You're a sculptor of non-existent personas. Done!",document.createElement("div")),i=(l.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),document.createElement("button")),o=(i.classList.add("stroke-danger-primary","text-danger-primary","relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),i.type="button",i.innerHTML='<i class="fa-solid fa-arrows-down-to-people transition-[stroke,opacity] opacity-60 group-hover:opacity-100"></i>',document.createElement("span"));return o.textContent="Set avatar",i.onclick=function(){document.querySelector(".footer-preview")&&createModalCropperAvatarImage(this,null)},i.appendChild(o),t.appendChild(a),t.appendChild(n),l.appendChild(i),e.appendChild(t),e.appendChild(l),e}function setButtonSelectAnalysis(){var e=document.createElement("div"),t=(e.classList.add("relative","group"),document.createElement("div")),a=(t.classList.add("hidden","absolute","p-2","group-hover:flex","items-center","gap-3","bottom-full","left-1/2","-translate-x-1/2","-translate-y-3.5","bg-dark-elements-hover","rounded-md","w-[300px]"),document.createElement("img")),n=(a.classList.add("w-20","h-20","rounded-md"),a.src="/static/modules/thumbnail/analyser.png",a.alt="Fake detector",a.width=256,a.height=256,document.createElement("span")),l=(n.classList.add("text-m-mobile","lg:text-m"),n.style="display: inline-block; vertical-align: top; text-decoration: inherit; text-wrap: balance;",n.textContent="Got a sneaky suspicion about some content? Ready to sniff out those deepfakes? Just hit that button.",document.createElement("div")),i=(l.classList.add("module-button-div","relative","flex","gap-2","items-center","rounded-md","bg-light-emphasis"),document.createElement("button")),o=(i.classList.add("relative","flex","gap-2","items-center","group","py-1.5","pl-2","whitespace-nowrap","font-extra-thick","pr-2"),i.type="button",i.innerHTML='<svg width="20px" height="20px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="white" class="w-4 h-4 transition-[stroke,opacity] opacity-60 group-hover:opacity-100"><path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5zM3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-7zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7z"/></svg>',document.createElement("span"));return o.textContent="Analysis",i.onclick=function(){document.querySelector(".footer-preview")&&createModalLoadAnalysis(sendModuleData.sourceFile.urlFile,sendModuleData.sourceFile.formatFile)},i.appendChild(o),t.appendChild(a),t.appendChild(n),l.appendChild(i),e.appendChild(t),e.appendChild(l),e}createFooterVideoOrImage(callbacks);
