class HistoryStack{#items;constructor(){this.#items=[]}push(e){this.#items.push(e)}pop(){return this.#items.pop()}peek(){return this.#items[this.#items.length-1]}isEmpty(){return 0===this.#items.length}size(){return this.#items.length}print(){console.log(this.#items.join(", "))}}let prePaths=new HistoryStack,forPaths=new HistoryStack,fodderPath="/",fileSystem=userFileTree,selected_item={item:{},index:0};function initFileManager(e,t={keepHistory:!0}){fodderPath=e,document.querySelector(".folder-path-input").value=fodderPath,t.keepHistory&&prePaths.push(e);let i=JSON.parse(JSON.stringify(fileSystem));for(const a of e.split("/").filter(Boolean))for(const n of i)if(n.name===a&&n.isDirectory){i=n.child;break}setupFilemanager(i)}function setupFilemanager(a){(filesContainer=document.querySelector(".filemanager-container-row")).innerHTML="",resetHistoryBtn();var n=document.getElementById("file-template"),t=document.getElementById("folder-template");let o=0;var r="ontouchstart"in window||navigator.msMaxTouchPoints;for(const l in a){let i,e;var s=a[l].visible;if(a[l].isDirectory)e=t.content.cloneNode(!0),(i=e.querySelector(".folder")).setAttribute("title",a[l].name),i.querySelector(".folder-name").textContent=a[l].name,i.querySelector(".folder-datetime").textContent=formatDateTime(a[l].created),r?i.addEventListener("click",e=>{!function(){var e=(new Date).getTime(),t=e-o;if(t<500&&0<t)return 1;o=e}()&&initFileManager(fodderPath+a[l].name+"/")}):i.addEventListener("dblclick",e=>{initFileManager(fodderPath+a[l].name+"/")});else{e=n.content.cloneNode(!0),(i=e.querySelector(".file")).setAttribute("title",a[l].name);const c=window.location.origin+"/media/content/"+userContentId+fodderPath+a[l].name;i.querySelector(".file-name").textContent=a[l].name,i.querySelector(".file-datetime").textContent=formatDateTime(a[l].created);let t=getFileIconMeta(a[l]);i.querySelector(".file-extension").innerHTML=t.icon,i.addEventListener("dblclick",e=>{console.log("Double click on file:",a[l].name),"video"===t.format?createModalVideo(c,a[l],reloadFileManager):"image"===t.format?createModalImage(c,a[l],reloadFileManager):"audio"===t.format&&createModalAudio(c,a[l],reloadFileManager)})}s||(i.style.display="none"),i.addEventListener("click",e=>{selected_item.index=l,selected_item.item=a[l],document.querySelector(".item-selected")?.classList.remove("item-selected"),i.classList.add("item-selected")}),filesContainer.appendChild(e)}}function getFileIconMeta(e){let t=e.name.split(".")[e.name.split(".").length-1],i='<i class="fa-solid fa-code"></i>',a="other";switch(t){case"jpg":case"jpeg":case"png":case"gif":i='<i class="fa-solid fa-mountain-sun"></i>',a="image";break;case"mp4":case"mov":case"avi":i='<i class="fa-solid fa-video"></i>',a="video";break;case"mp3":case"wav":case"ogg":i='<i class="fa-solid fa-music"></i>',a="audio";break;default:t=".?"}return{ext:t.toUpperCase(),icon:i,format:a}}function backwardFileManager(){var e;prePaths.isEmpty()||(e=prePaths.pop(),forPaths.push(e),initFileManager(prePaths.peek(),{keepHistory:!1}))}function forwardFileManager(){var e;forPaths.isEmpty()||(e=forPaths.pop(),prePaths.push(e),initFileManager(e,{keepHistory:!1}))}function resetHistoryBtn(){prePaths.size()-1==0?document.getElementById("backwardBtn").setAttribute("disabled",!0):document.getElementById("backwardBtn").removeAttribute("disabled"),forPaths.isEmpty()?document.getElementById("forwardBtn").setAttribute("disabled",!0):document.getElementById("forwardBtn").removeAttribute("disabled")}function openFileManagerModal(){var e,t;selected_item.item?.name&&(fodderPath,selected_item.item?.name,selected_item.item?.isDirectory?frontendConsoleLogToBackendPrint("This button you can use one files."):0<(e=document.querySelectorAll(".item-selected")).length?(e=e[0],t=new MouseEvent("dblclick",{bubbles:!0,cancelable:!0,view:window}),e.dispatchEvent(t)):console.error("No elements found with class 'item-selected'"))}function openDeleteFileManagerModal(){var e;selected_item.item?.name&&(fodderPath,selected_item.item?.name,selected_item.item?.isDirectory?frontendConsoleLogToBackendPrint("You cannot delete the folder.Try removing the file separately."):(e=createStaticSrc(fodderPath,selected_item.item?.name),openDeleteNoticeModal(e).then(e=>{reloadFileManager()}).catch(e=>{})))}function openRenameFileManagerModal(){var e;selected_item.item?.name&&(selected_item.item?.isDirectory?frontendConsoleLogToBackendPrint("You cannot rename the folder.Try replacing the file separately."):(e=createStaticSrc(fodderPath,selected_item.item?.name),openRenameNoticeModal(e).then(e=>{reloadFileManager()}).catch(e=>{})))}function reloadFileManager(){fetch("/content-reload",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{200===e.status?(fileSystem=e.user_file_tree,fileSys=JSON.parse(JSON.stringify(fileSystem)),initFileManager(fodderPath,{keepHistory:!1})):frontendConsoleLogToBackendPrint(e.message)}).catch(e=>{console.error("Error:",e)})}initFileManager(fodderPath);
